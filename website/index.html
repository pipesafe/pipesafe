<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PipeSafe - Type-safe MongoDB Aggregations</title>
    <meta
      name="description"
      content="Type-safe MongoDB aggregation pipeline builder for TypeScript. Catch errors at compile time, not runtime."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <div class="hero">
        <h1>PIPESAFE</h1>
        <p class="tagline">Type-safe MongoDB aggregations.</p>
        <div class="install-box" onclick="copyCommand()" title="Click to copy">
          <span class="prompt">$</span>
          <span class="command">npm install pipesafe</span>
          <span class="copy-feedback" id="copy-feedback">Copied!</span>
        </div>
        <div class="social-links">
          <a
            href="https://github.com/covahltd/tmql"
            class="social-link"
            title="GitHub"
          >
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
              <path
                d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"
              />
            </svg>
          </a>
          <a
            href="https://www.npmjs.com/package/tmql"
            class="social-link"
            title="npm"
          >
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
              <path
                d="M0 7.334v8h6.666v1.332H12v-1.332h12v-8H0zm6.666 6.664H5.334v-4H3.999v4H1.335V8.667h5.331v5.331zm4 0v1.336H8.001V8.667h5.334v5.332h-2.669v-.001zm12.001 0h-1.33v-4h-1.336v4h-1.335v-4h-1.33v4h-2.671V8.667h8.002v5.331z"
              />
            </svg>
          </a>
        </div>
        <p class="status">
          Coming soon. Currently available as
          <a href="https://www.npmjs.com/package/tmql">tmql</a> on NPM.
        </p>
      </div>

      <div class="terminal" id="runtime-terminal">
        <div class="terminal-header">
          <div class="terminal-dot red"></div>
          <div class="terminal-dot yellow"></div>
          <div class="terminal-dot green"></div>
          <span class="terminal-title">WITHOUT PIPESAFE</span>
        </div>
        <div class="terminal-body">
          <pre
            class="code"
          ><span class="field">db</span>.<span class="field">orders</span>.<span class="keyword">aggregate</span>([
  { <span class="string">$lookup</span>: {
    <span class="field">from</span>: <span class="string">"users"</span>,
    <span class="field">localField</span>: <span class="string">"userId"</span>
    <span class="comment">// missing foreignField and as</span>
  }},
  { <span class="string">$match</span>: { <span class="field">total</span>: { <span class="operator">$gt</span>: <span class="string">"100"</span> } }},
  { <span class="string">$set</span>: {
    <span class="field">withTax</span>: { <span class="operator">$multiply</span>: [<span class="string">"$totl"</span>, <span class="field">1.2</span>] },
    <span class="field">fullName</span>: { <span class="operator">$concat</span>: [
      <span class="string">"$firstName"</span>,
      <span class="field">123</span>
    ]}
  }},
  { <span class="string">$project</span>: { <span class="field">withTax</span>: <span class="field">1</span>, <span class="field">fullName</span>: <span class="field">1</span> }}
])</pre>
          <div class="step-indicator" id="deploying-indicator">
            <span class="step-running"
              >> Deploying to staging<span class="dots"></span
            ></span>
            <span class="step-done">âœ“ Deployed to staging</span>
          </div>
          <div class="step-indicator" id="running-indicator">
            <span class="step-running"
              >> Running pipeline<span class="dots"></span
            ></span>
            <span class="step-done step-failed">âœ— Pipeline failed</span>
          </div>
          <div class="error-sections" id="runtime-errors">
            <div class="error-section">
              <div class="error-section-title compile">
                Errors detected at compile time
              </div>
              <div class="error-none">None</div>
            </div>
            <div class="error-section">
              <div class="error-section-title runtime">
                Errors detected at runtime
              </div>
              <div class="runtime-error-msg" id="runtime-error-msg">
                > MongoServerError: must specify 'as' field for a $lookup
              </div>
              <div class="runtime-error-note" id="runtime-error-note">
                The other 3 bugs? No error. Wrong results. Good luck.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="terminal" id="compile-terminal">
        <div class="terminal-header">
          <div class="terminal-dot red"></div>
          <div class="terminal-dot yellow"></div>
          <div class="terminal-dot green"></div>
          <span class="terminal-title">WITH PIPESAFE</span>
        </div>
        <div class="terminal-body">
          <pre
            class="code"
          ><span class="field">db</span>.<span class="field">orders</span>.<span class="keyword">aggregate</span>&lt;<span class="keyword">Order</span>&gt;()
  .<span class="error-underline" data-error="1">lookup</span>({
    <span class="field">from</span>: <span class="string">"users"</span>,
    <span class="field">localField</span>: <span class="string">"userId"</span><span class="fixable-code" data-fix="1"><span class="broken"></span><span class="fixed">,
    <span class="field">foreignField</span>: <span class="string">"_id"</span>,
    <span class="field">as</span>: <span class="string">"user"</span></span></span>
  })<span class="code-cursor" data-cursor="1"></span>
  .<span class="keyword">match</span>({ <span class="field">total</span>: { <span class="operator">$gt</span>: <span class="fixable-code" data-fix="2"><span class="broken error-underline" data-error="2">"100"</span><span class="fixed field">100</span></span><span class="code-cursor" data-cursor="2"></span> } })
  .<span class="keyword">set</span>({
    <span class="field">withTax</span>: { <span class="operator">$multiply</span>: [<span class="fixable-code" data-fix="3"><span class="broken error-underline" data-error="3">"$totl"</span><span class="fixed string">"$total"</span></span><span class="code-cursor" data-cursor="3"></span>, <span class="field">1.2</span>] },
    <span class="field">fullName</span>: { <span class="operator">$concat</span>: [
      <span class="string">"$firstName"</span>,
      <span class="fixable-code" data-fix="4"><span class="broken error-underline" data-error="4">123</span><span class="fixed"><span class="string">" "</span>,
      <span class="string">"$lastName"</span></span></span><span class="code-cursor" data-cursor="4"></span>
    ]}
  })
  .<span class="keyword">project</span>({ <span class="field">withTax</span>: <span class="field">1</span>, <span class="field">fullName</span>: <span class="field">1</span> })</pre>
          <div class="error-sections" id="compile-errors">
            <div class="error-section" id="compile-section">
              <div class="error-section-title compile">
                Errors detected at compile time
              </div>
              <div class="error-line" data-error="1">
                &#10007; $lookup missing required fields
              </div>
              <div class="error-detail" data-error="1">
                Required: "foreignField", "as"
              </div>
              <div class="error-line" data-error="2">
                &#10007; Type 'string' not assignable to 'number'
              </div>
              <div class="error-detail" data-error="2">
                $gt on number field requires number
              </div>
              <div class="error-line" data-error="3">
                &#10007; "$totl" does not exist on Order
              </div>
              <div class="error-detail" data-error="3">
                Did you mean "$total"?
              </div>
              <div class="error-line" data-error="4">
                &#10007; Type 'number' not assignable to 'string'
              </div>
              <div class="error-detail" data-error="4">
                $concat operands must be strings
              </div>
              <button
                class="fix-btn"
                id="fix-btn"
                onclick="startFixAnimation()"
              >
                <span class="lightbulb">ðŸ’¡</span> Quick Fix with AI
              </button>
              <div class="all-clear" id="all-clear">&#10003; No errors</div>
            </div>
            <div class="error-section">
              <div class="error-section-title runtime">
                Errors detected at runtime
              </div>
              <div class="error-success" id="compile-success">
                None â€” caught before hitting production
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="replay-container" id="replay-container">
        <button class="replay-btn" onclick="replayAnimations()">Replay</button>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
